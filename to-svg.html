<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
    />
    <link rel="stylesheet" href="stylesheet.css" />
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <title>ToolBox | To SVG</title>
    <script src="https://cdn.jsdelivr.net/npm/imagetracerjs"></script>
  </head>
  <body>
    <header>
      <a
        class="tb-back-button"
        href="/toolbox"
        onclick="if (window.location.hostname === 'localhost') this.href = 'index.html';"
        >Back to Home</a
      >
    </header>
    <section class="tb-title">
      <h1>Media to SVG</h1>
      <p>A tool to convert media files to SVG.</p>
    </section>
    <section>
      <input type="file" id="fileInput" accept="image/*" />
      <label for="fileInput" id="fileLabel" class="drag-and-drop">
        <p>Drag and drop a file here</p>
        <p>or click to select a file</p>
      </label>
      <button id="convertButton">Convert</button>
      <div class="notice-container">
        <h3>Notice</h3>
        <p>This tool uses ImageTracer.js for SVG conversion.</p>
      </div>
    </section>
    <!-- <div id="outputContainer"></div> -->
    <footer>
      <a href="https://github.com/riiisho/toolbox">View on GitHub</a>
      <p>Made with ❤️ by @riiisho</p>
    </footer>
  </body>
</html>

<script>
  const fileInput = document.getElementById("fileInput");
  const fileLabel = document.getElementById("fileLabel");
  const convertButton = document.getElementById("convertButton");
  // const outputContainer = document.getElementById("outputContainer");

  // Update label when a file is selected
  fileInput.addEventListener("change", () => {
    if (fileInput.files.length > 0) {
      const fileName = fileInput.files[0].name;
      fileLabel.textContent = `Selected file: ${fileName}`;
    }
  });

  // Convert button click handler
  convertButton.addEventListener("click", async () => {
    const file = fileInput.files[0];
    if (!file) {
      alert("Please select a file first.");
      return;
    }

    try {
      const img = await loadImage(file);
      const canvas = document.createElement("canvas");
      canvas.width = img.width;
      canvas.height = img.height;
      const ctx = canvas.getContext("2d");
      ctx.drawImage(img, 0, 0);

      // Convert canvas to SVG using ImageTracer.js
      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const svgData = ImageTracer.imagedataToSVG(imageData);

      // Display the SVG in the output container
      // outputContainer.innerHTML = `<h3>Generated SVG:</h3><div>${svgData}</div>`;

      // Provide a download link for the SVG
      downloadSVG(svgData, "output.svg");
    } catch (error) {
      console.error("Error during conversion:", error);
      alert(
        "An error occurred during the conversion process. Please try again with a different image."
      );
    }
  });

  // Helper function to load an image from a file
  function loadImage(file) {
    return new Promise((resolve, reject) => {
      const img = new Image();
      img.onload = () => resolve(img);
      img.onerror = () =>
        reject(
          new Error(
            "Failed to load the image. Please ensure the file is a valid image."
          )
        );
      img.src = URL.createObjectURL(file);
    });
  }

  // Helper function to download the SVG
  function downloadSVG(svgContent, fileName) {
    const blob = new Blob([svgContent], { type: "image/svg+xml" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = fileName;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }
</script>
